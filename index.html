<!DOCTYPE html>
<html lang="ar" dir="rtl" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dua of the Day | ÿØÿπÿßÿ° ÿßŸÑŸäŸàŸÖ</title>
    
    <!-- SOCIAL PREVIEW -->
    <meta property="og:title" content="Dua of the Day | ÿØÿπÿßÿ° ÿßŸÑŸäŸàŸÖ üåô">
    <meta property="og:description" content="A daily Dua for the holy month of Ramadan.">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://Marwan-Official.github.io/Dua-Of-The-Day/preview.png">
    <meta property="og:url" content="https://Marwan-Official.github.io/Dua-Of-The-Day/">
    
    <!-- PWA / APP-IFICATION META TAGS -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Dua of the Day">
    <meta name="theme-color" content="#000000" id="metaThemeColor">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Cairo:wght@400;600;700;800;900&family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'amoled': '#000000',
                        'light-bg': '#F9FAFB', 
                        'theme-dark': 'var(--theme-dark)',
                        'theme-light': 'var(--theme-light)',
                    },
                    fontFamily: {
                        sans: ['"Outfit"', 'sans-serif'],
                        cairo: ['"Cairo"', 'sans-serif'],
                        amiri: ['"Amiri"', 'serif'],
                    },
                    animation: {
                        'fade-in-site': 'fadeInSite 1.2s ease-out forwards',
                        'swing': 'swing 3s cubic-bezier(0.4, 0, 0.6, 1) infinite alternate', 
                        'swing-slow': 'swing 5s cubic-bezier(0.4, 0, 0.6, 1) infinite alternate-reverse', 
                        'glow-pulse': 'glowPulse 3s infinite alternate',
                        'drift': 'drift 15s linear infinite alternate',
                    },
                    keyframes: {
                        fadeInSite: {
                            '0%': { opacity: '0', transform: 'scale(0.98)' },
                            '100%': { opacity: '1', transform: 'scale(1)' },
                        },
                        swing: {
                            '0%': { transform: 'rotate(5deg)' },
                            '100%': { transform: 'rotate(-5deg)' },
                        },
                        glowPulse: {
                            '0%': { filter: 'drop-shadow(0 0 5px currentColor)' },
                            '100%': { filter: 'drop-shadow(0 0 20px currentColor)' }
                        },
                        drift: {
                            '0%': { transform: 'translate(0%, 0%) scale(1)' },
                            '100%': { transform: 'translate(5%, 5%) scale(1.05)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        :root {
            --theme-dark: #FF1040; 
            --theme-dark-rgb: 255, 16, 64; 
            --theme-light: #D90429;
            --theme-light-rgb: 217, 4, 41;
        }

        /* STRICT MOBILE SCROLL LOCK */
        html, body {
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100dvh;
            overflow: hidden !important; 
            overscroll-behavior: none; 
            position: fixed; 
            inset: 0;
            background-color: var(--light-bg);
            -webkit-tap-highlight-color: transparent; 
        }

        .dark body { background-color: #000000; }

        body {
            transition: background-color 0.5s ease, color 0.5s ease;
        }

        *, *::before, *::after {
            transition-property: background-color, border-color, color, fill, stroke, opacity, box-shadow, filter, font-size, transform, text-shadow;
            transition-duration: 400ms;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
        }

        #colorThumb { transition: none !important; }
        #colorCenterPreview { transition: background-color 0.1s ease !important; }

        ::-webkit-scrollbar { display: none; width: 0px; background: transparent; }
        ::selection { background-color: var(--theme-dark); color: black; }

        .dropdown-enter {
            opacity: 0;
            transform: translateX(10px) scale(0.95);
            pointer-events: none;
            visibility: hidden;
        }
        .dropdown-active {
            opacity: 1;
            transform: translateX(0) scale(1);
            pointer-events: auto;
            visibility: visible;
        }

        @keyframes floatParticle {
            0% { transform: translateY(110vh) scale(0); opacity: 0; }
            20% { opacity: var(--p-opacity); }
            80% { opacity: var(--p-opacity); }
            100% { transform: translateY(-10vh) scale(1); opacity: 0; }
        }

        .particle {
            position: absolute;
            border-radius: 50%;
            pointer-events: none;
            background-color: currentColor; 
            box-shadow: 0 0 10px currentColor;
            opacity: 0; 
            animation-name: floatParticle;
            animation-timing-function: linear;
            animation-iteration-count: infinite;
            z-index: 0; 
        }

        .ambient-glow {
            position: absolute;
            border-radius: 50%;
            background-color: var(--theme-light);
            -webkit-mask-image: radial-gradient(circle, black 0%, transparent 70%);
            mask-image: radial-gradient(circle, black 0%, transparent 70%);
            opacity: 0.15; 
            pointer-events: none;
            z-index: -5;
        }
        .dark .ambient-glow { background-color: var(--theme-dark); opacity: 0.15; }

        .badge-shadow { box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05), 0 2px 10px rgba(var(--theme-light-rgb), 0.1); }
        .dark .badge-shadow { box-shadow: 0 4px 15px rgba(var(--theme-dark-rgb), 0.15); }
        
        .dark .text-neon {
            text-shadow: 0 0 20px rgba(var(--theme-dark-rgb), 0.3), 0 0 40px rgba(var(--theme-dark-rgb), 0.1);
        }

        .quote-mark { color: #D1D5DB; }
        .dark .quote-mark { color: #333333; }
        .font-cairo { line-height: 1.6 !important; }
        .font-amiri { line-height: 2.2 !important; }
        .lantern-glow { animation: glowPulse 4s ease-in-out infinite alternate; }
        .rotate-icon { transform: rotate(45deg); }
        
        .blur-fade-out { opacity: 0 !important; filter: blur(8px) !important; transform: scale(0.98) !important; }

        .conic-ring {
            background: conic-gradient(red, yellow, lime, cyan, blue, magenta, red);
            border-radius: 50%;
            touch-action: none; 
        }

        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        .mask-vertical {
            -webkit-mask-image: linear-gradient(to bottom, transparent 0%, black 40%, black 60%, transparent 100%);
            mask-image: linear-gradient(to bottom, transparent 0%, black 40%, black 60%, transparent 100%);
        }
        .roller-item {
            height: 40px;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            scroll-snap-align: center;
        }
        .badge-open {
            height: 120px !important;
            border-color: var(--theme-light) !important;
        }
        .dark .badge-open {
            border-color: var(--theme-dark) !important;
        }
        
        @keyframes gentleBreathe {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.015); }
        }
        .animate-breathe {
            animation: gentleBreathe 8s ease-in-out infinite;
        }
    </style>
</head>
<body class="text-gray-900 dark:text-white flex flex-col items-center justify-center select-none animate-fade-in-site w-full h-[100dvh]">

    <!-- ATMOSPHERE -->
    <div id="particlesContainer" class="absolute inset-0 z-0 overflow-hidden pointer-events-none opacity-50 dark:opacity-60"></div>
    <div class="ambient-glow w-[500px] h-[500px] top-[-10%] left-[-10%] animate-drift" style="animation-delay: 0s;"></div>
    <div class="ambient-glow w-[400px] h-[400px] bottom-[-10%] right-[-10%] animate-drift" style="animation-delay: -5s; animation-direction: alternate-reverse;"></div>

    <!-- === PARALLAX LANTERNS === -->
    <div class="absolute top-0 left-6 md:left-20 z-[-1] opacity-80 dark:opacity-80 pointer-events-none origin-top animate-swing scale-75 md:scale-100 text-theme-light dark:text-theme-dark">
        <svg width="60" height="180" viewBox="0 0 100 300" fill="none" xmlns="http://www.w3.org/2000/svg" class="lantern-glow">
            <line x1="50" y1="0" x2="50" y2="50" stroke="currentColor" stroke-width="2" class="text-gray-400 dark:text-gray-700"/>
            <path d="M50 50 L80 80 L80 140 L50 170 L20 140 L20 80 Z" stroke="currentColor" stroke-width="3" class="fill-transparent"/>
            <path d="M50 50 L50 170" stroke="currentColor" stroke-width="1" class="text-gray-400 dark:text-gray-700"/>
            <path d="M20 80 L80 80" stroke="currentColor" stroke-width="1" class="text-gray-400 dark:text-gray-700"/>
            <path d="M20 140 L80 140" stroke="currentColor" stroke-width="1" class="text-gray-400 dark:text-gray-700"/>
            <line x1="50" y1="170" x2="50" y2="220" stroke="currentColor" stroke-width="2" class="text-gray-400 dark:text-gray-700"/>
            <circle cx="50" cy="225" r="5" class="fill-current"/>
        </svg>
    </div>

    <div class="absolute top-[-20px] right-6 md:right-32 z-[-2] opacity-40 dark:opacity-50 pointer-events-none origin-top animate-swing-slow blur-[2px] scale-[0.6] md:scale-75 text-theme-light dark:text-theme-dark">
        <svg width="60" height="180" viewBox="0 0 100 300" fill="none" xmlns="http://www.w3.org/2000/svg">
            <line x1="50" y1="0" x2="50" y2="50" stroke="currentColor" stroke-width="2" class="text-gray-400 dark:text-gray-800"/>
            <path d="M50 50 L80 80 L80 140 L50 170 L20 140 L20 80 Z" stroke="currentColor" stroke-width="2" class="fill-transparent"/> 
            <path d="M50 50 L50 170" stroke="currentColor" stroke-width="1" class="text-gray-400 dark:text-gray-800"/>
            <path d="M20 80 L80 80" stroke="currentColor" stroke-width="1" class="text-gray-400 dark:text-gray-800"/>
            <path d="M20 140 L80 140" stroke="currentColor" stroke-width="1" class="text-gray-400 dark:text-gray-800"/>
            <line x1="50" y1="170" x2="50" y2="220" stroke="currentColor" stroke-width="2" class="text-gray-400 dark:text-gray-800"/>
            <circle cx="50" cy="225" r="5" class="fill-current"/>
        </svg>
    </div>

    <!-- Controls -->
    <div id="controlsContainer" dir="ltr" class="absolute top-4 right-4 md:top-6 md:right-6 flex items-center gap-4 text-[10px] sm:text-xs md:text-sm font-bold tracking-wider text-gray-400 dark:text-gray-500 z-50 transition-opacity duration-500">
        <button id="langToggle" onclick="toggleLanguage()" class="hover:text-black dark:hover:text-white uppercase py-2 tracking-widest">AR</button>

        <!-- Color Toggle -->
        <div class="relative">
            <button id="colorToggle" onclick="toggleColorDropdown(event)" class="hover:text-theme-light dark:hover:text-theme-dark py-2 group z-50 relative" aria-label="Change Color">
                <svg id="paletteIcon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 md:h-6 md:w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01" />
                </svg>
            </button>
            
            <!-- Palette Menu -->
            <div id="colorDropdown" class="absolute right-10 top-0 flex flex-row gap-2 md:gap-3 items-center bg-white dark:bg-[#151515] p-2 rounded-full shadow-2xl border border-gray-100 dark:border-gray-800 dropdown-enter backdrop-blur-md z-40 pr-4">
                <button onclick="selectColor(0)" class="w-5 h-5 md:w-6 md:h-6 rounded-full bg-[#00FF88] hover:scale-125 shadow-sm"></button>
                <button onclick="selectColor(1)" class="w-5 h-5 md:w-6 md:h-6 rounded-full bg-[#FF1040] hover:scale-125 shadow-sm"></button> <!-- CHILLY RED -->
                <button onclick="selectColor(2)" class="w-5 h-5 md:w-6 md:h-6 rounded-full bg-[#3B82F6] hover:scale-125 shadow-sm"></button>
                <button onclick="selectColor(3)" class="w-5 h-5 md:w-6 md:h-6 rounded-full bg-[#FACC15] hover:scale-125 shadow-sm"></button>
                
                <!-- Custom Color Ring Trigger -->
                <button onclick="openColorPicker(event)" class="w-5 h-5 md:w-6 md:h-6 rounded-full hover:scale-125 shadow-sm bg-[conic-gradient(red,yellow,lime,cyan,blue,magenta,red)] flex justify-center items-center text-[10px]" title="Custom Color"></button>
            </div>
        </div>

        <button id="themeToggle" onclick="toggleTheme()" class="hover:text-black dark:hover:text-white transform hover:scale-110 active:scale-95 p-1 relative w-5 h-5 md:w-6 md:h-6">
            <div id="iconWrapper" class="relative w-full h-full flex items-center justify-center">
                <svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 md:h-6 md:w-6 absolute opacity-0 scale-50 rotate-90" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                </svg>
                <svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 md:h-6 md:w-6 absolute opacity-0 scale-50 -rotate-90" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                </svg>
            </div>
        </button>
    </div>

    <!-- Main Content -->
    <div id="mainContainer" class="w-full max-w-4xl px-4 sm:px-8 md:px-12 flex flex-col justify-center text-center z-10 relative">
        
        <!-- Day Badge with Embedded Time Machine Roller -->
        <div id="dayBadgeContainer" class="flex justify-center mb-4 md:mb-8 transition-opacity duration-500">
            <div id="badgeWrapper" class="relative rounded-full bg-white/90 dark:bg-white/5 backdrop-blur-md border border-gray-200/80 dark:border-white/10 badge-shadow cursor-pointer transition-all duration-300 h-[36px] md:h-[44px] overflow-hidden flex flex-col items-center justify-center w-[200px] md:w-[240px]">
                
                <h2 id="ramadanDay" dir="auto" class="text-xs sm:text-sm md:text-base font-bold text-theme-light dark:text-theme-dark tracking-[0.2em] uppercase transition-opacity duration-300 w-max whitespace-nowrap absolute"></h2>
                
                <div id="dayRoller" class="absolute inset-0 w-full h-full hidden overflow-y-scroll snap-y snap-mandatory scrollbar-hide mask-vertical text-center z-20">
                    <div id="rollerInner" class="flex flex-col items-center w-full">
                        <!-- Injected by JS -->
                    </div>
                </div>
            </div>
        </div>
        
        <div class="relative py-2 px-2 sm:px-4 rounded-3xl w-full flex flex-col items-center">
            <span id="quoteTop" class="quote-mark absolute -top-4 md:-top-6 left-0 text-5xl md:text-7xl font-serif select-none opacity-50">‚Äú</span>
            
            <h1 id="duaMain" dir="auto" class="animate-breathe text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold tracking-normal mb-2 leading-loose text-gray-900 dark:text-white font-amiri drop-shadow-sm flex items-center justify-center py-2 max-w-full min-h-[100px] md:min-h-[140px] dark:text-neon"></h1>
            
            <p id="duaTranslation" dir="auto" class="text-sm sm:text-base md:text-xl text-gray-500 dark:text-gray-400 font-medium leading-relaxed max-w-xl mx-auto font-sans mt-2 md:mt-0 transition-opacity duration-500"></p>
            <span id="quoteBottom" class="quote-mark absolute -bottom-6 md:-bottom-10 right-0 text-5xl md:text-7xl font-serif select-none opacity-50">‚Äù</span>
        </div>
        
        <div class="mt-8 md:mt-12 flex flex-col items-center gap-2 md:gap-3 transition-opacity duration-500">
            <div id="separatorLine" class="w-12 h-[3px] md:w-16 md:h-1 bg-theme-light dark:bg-theme-dark rounded-full opacity-60 shadow-[0_0_8px_currentColor] text-theme-light dark:text-theme-dark"></div>
            <p id="currentDate" dir="auto" class="text-[10px] sm:text-xs md:text-sm text-gray-400 dark:text-gray-500 font-bold tracking-[0.1em] uppercase mt-2 md:mt-4"></p>
        </div>
    </div>

    <!-- Footer -->
    <div id="footerContainer" class="absolute bottom-6 w-full flex justify-center px-4 z-10 pointer-events-none transition-opacity duration-500">
        <p id="footerText" dir="auto" class="pointer-events-auto text-[8px] sm:text-[10px] md:text-xs text-gray-400 dark:text-gray-600 font-bold uppercase tracking-[0.2em] hover:text-theme-light dark:hover:text-theme-dark cursor-pointer opacity-60 hover:opacity-100 transition-colors">
            Created by Marwan Elmoghazy.
        </p>
    </div>

    <!-- Custom Live Color Picker UI -->
    <div id="customColorModal" dir="ltr" class="fixed inset-0 z-[100] flex items-center justify-center opacity-0 pointer-events-none transition-opacity duration-500 backdrop-blur-xl bg-black/40 dark:bg-black/60" onclick="closeColorPicker(event)">
        <div class="bg-white/80 dark:bg-[#111]/80 backdrop-blur-md p-8 rounded-[3rem] shadow-2xl flex flex-col items-center gap-8 border border-white/20 dark:border-white/10 transform scale-95 transition-transform duration-500" id="colorModalContent" onclick="event.stopPropagation()">
            <h3 class="text-gray-900 dark:text-white font-bold tracking-widest uppercase text-xs opacity-70">Slide to Pick</h3>
            
            <div id="wheelContainer" class="relative w-48 h-48 sm:w-56 sm:h-56 flex items-center justify-center">
                <div class="absolute inset-0 conic-ring shadow-lg" id="colorWheel"></div>
                <div class="absolute w-36 h-36 sm:w-44 sm:h-44 bg-white/90 dark:bg-[#111]/90 rounded-full flex items-center justify-center pointer-events-none">
                    <div id="colorCenterPreview" class="w-16 h-16 rounded-full shadow-inner opacity-80"></div>
                </div>
                <div id="colorThumb" class="absolute w-8 h-8 rounded-full border-4 border-white shadow-lg z-10 transform -translate-x-1/2 -translate-y-1/2 pointer-events-none"></div>
            </div>
            
            <button onclick="closeColorPicker(event, true)" class="mt-2 px-8 py-3 rounded-full bg-gray-900 dark:bg-white text-white dark:text-black font-bold text-xs uppercase tracking-widest transition-transform hover:scale-105 active:scale-95 shadow-md">
                Apply Theme
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            const safeStorage = {
                getItem: (key) => { try { return localStorage.getItem(key); } catch (e) { return null; } },
                setItem: (key, val) => { try { localStorage.setItem(key, val); } catch (e) {} }
            };

            let storedLang = safeStorage.getItem('saved_lang');
            let lang = storedLang ? storedLang : 'ar'; 

            let storedColor = safeStorage.getItem('saved_color_index');
            let currentColorIndex = storedColor !== null ? parseInt(storedColor) : 0; 
            if (isNaN(currentColorIndex)) currentColorIndex = 0; 

            let storedTheme = safeStorage.getItem('saved_theme');
            let isDark;
            if (storedTheme) {
                isDark = storedTheme === 'dark';
            } else {
                isDark = true; 
            }
            
            let dropdownOpen = false;
            let isZenMode = false;
            let customHue = parseInt(safeStorage.getItem('saved_custom_hue')) || 350; 
            let tempHue = customHue; 
            
            const ramadanStartDate = new Date(2026, 1, 19); 
            
            function getRealRamadanDay() {
                const now = new Date();
                now.setHours(0, 0, 0, 0);
                const diffTime = now - ramadanStartDate;
                const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24)) + 1;
                if (diffDays < 1) return 1; 
                return diffDays;
            }
            
            let currentActiveDay = getRealRamadanDay();

            const colorThemes = [
                { name: 'green',  light: '#059669', dark: '#00FF88', rgbDark: '0, 255, 136', rgbLight: '5, 150, 105' },   
                { name: 'red',    light: '#D90429', dark: '#FF1040', rgbDark: '255, 16, 64', rgbLight: '217, 4, 41' },   
                { name: 'blue',   light: '#2563EB', dark: '#3B82F6', rgbDark: '59, 130, 246', rgbLight: '37, 99, 235' },  
                { name: 'yellow', light: '#CA8A04', dark: '#FACC15', rgbDark: '250, 204, 21', rgbLight: '202, 138, 4' }   
            ];

            const duas = [
                { ar: "ÿ±Ÿéÿ®ŸéŸëŸÜŸéÿß ÿ¢ÿ™ŸêŸÜŸéÿß ŸÅŸêŸä ÿßŸÑÿØŸèŸëŸÜŸíŸäŸéÿß ÿ≠Ÿéÿ≥ŸéŸÜŸéÿ©Ÿã ŸàŸéŸÅŸêŸä ÿßŸÑÿ¢ÿÆŸêÿ±Ÿéÿ©Ÿê ÿ≠Ÿéÿ≥ŸéŸÜŸéÿ©Ÿã ŸàŸéŸÇŸêŸÜŸéÿß ÿπŸéÿ∞Ÿéÿßÿ®Ÿé ÿßŸÑŸÜŸéŸëÿßÿ±Ÿê", en: "O Allah, give us in this world [that which is] good and in the Hereafter [that which is] good and protect us from the punishment of the Fire." }, // Day 1
                { ar: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ≤ŸéŸäŸêŸëŸÜŸêŸëŸä ŸÅŸêŸäŸáŸê ÿ®ŸêÿßŸÑÿ≥ŸêŸëÿ™Ÿíÿ±Ÿê ŸàŸéÿßŸÑŸíÿπŸéŸÅŸéÿßŸÅŸê ŸàŸéÿßÿ≥Ÿíÿ™Ÿèÿ±ŸíŸÜŸêŸä ŸÅŸêŸäŸáŸê ÿ®ŸêŸÑŸêÿ®Ÿéÿßÿ≥Ÿê ÿßŸÑŸíŸÇŸèŸÜŸèŸàÿπŸê ŸàŸéÿßŸÑŸíŸÉŸéŸÅŸéÿßŸÅŸê", en: "O Allah, adorn me with concealment and chastity, and cover me with the garment of contentment." }, // Day 2
                { ar: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ•ŸêŸÜŸêŸëŸä ÿ£Ÿéÿ≥Ÿíÿ£ŸéŸÑŸèŸÉŸé ŸÅŸêŸäŸáŸê ÿßŸÑŸÜŸéŸëÿπŸêŸäŸÖŸé ÿßŸÑŸíŸÖŸèŸÇŸêŸäŸÖŸé ÿßŸÑŸéŸëÿ∞ŸêŸä ŸÑŸéÿß ŸäŸéÿ≠ŸèŸàŸÑŸè ŸàŸéŸÑŸéÿß ŸäŸéÿ≤ŸèŸàŸÑŸè", en: "O Allah, I ask You for lasting bliss that does not change or disappear." }, // Day 3
                { ar: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ŸÑŸéÿß ÿ™Ÿèÿ§ŸéÿßÿÆŸêÿ∞ŸíŸÜŸêŸä ŸÅŸêŸäŸáŸê ÿ®ŸêÿßŸÑŸíÿπŸéÿ´Ÿéÿ±Ÿéÿßÿ™Ÿê ŸàŸéÿ£ŸéŸÇŸêŸÑŸíŸÜŸêŸä ŸÅŸêŸäŸáŸê ŸÖŸêŸÜŸé ÿßŸÑŸíÿÆŸéÿ∑ŸéÿßŸäŸéÿß ŸàŸéÿßŸÑŸíŸáŸéŸÅŸéŸàŸéÿßÿ™Ÿê", en: "O Allah, do not hold me accountable for my slips, and forgive my mistakes and errors." }, // Day 4
                { ar: "ŸäŸéÿß ŸÖŸèŸÇŸéŸÑŸêŸëÿ®Ÿé ÿßŸÑŸíŸÇŸèŸÑŸèŸàÿ®Ÿê ÿ´Ÿéÿ®ŸêŸëÿ™Ÿí ŸÇŸéŸÑŸíÿ®ŸêŸä ÿπŸéŸÑŸéŸâ ÿØŸêŸäŸÜŸêŸÉŸé", en: "O Turner of the hearts, make my heart firm upon Your religion." }, // Day 5
                { ar: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿßÿ±Ÿíÿ≤ŸèŸÇŸíŸÜŸêŸä ŸÅŸêŸäŸáŸê ŸÅŸéÿ∂ŸíŸÑŸé ŸÑŸéŸäŸíŸÑŸéÿ©Ÿê ÿßŸÑŸíŸÇŸéÿØŸíÿ±Ÿê ŸàŸéÿµŸéŸäŸêŸëÿ±Ÿí ÿ£ŸèŸÖŸèŸàÿ±ŸêŸä ŸÅŸêŸäŸáŸê ŸÖŸêŸÜŸé ÿßŸÑŸíÿπŸèÿ≥Ÿíÿ±Ÿê ÿ•ŸêŸÑŸéŸâ ÿßŸÑŸíŸäŸèÿ≥Ÿíÿ±Ÿê", en: "O Allah, grant me the virtue of Laylat al-Qadr, and change my affairs from difficulty to ease." }, // Day 6
                { ar: "ÿ±Ÿéÿ®ŸêŸë ÿßÿ∫ŸíŸÅŸêÿ±Ÿí ŸÑŸêŸä ŸàŸéÿ™Ÿèÿ®Ÿí ÿπŸéŸÑŸéŸäŸéŸë ÿ•ŸêŸÜŸéŸëŸÉŸé ÿ£ŸéŸÜŸíÿ™Ÿé ÿßŸÑÿ™ŸéŸëŸàŸéŸëÿßÿ®Ÿè ÿßŸÑÿ±ŸéŸëÿ≠ŸêŸäŸÖŸè", en: "O Allah, forgive me and accept my repentance; You are the Accepting of repentance, the Merciful." }, // Day 7
                { ar: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿßÿ¨ŸíÿπŸéŸÑŸí ÿµŸêŸäŸéÿßŸÖŸêŸä ŸÅŸêŸäŸáŸê ÿµŸêŸäŸéÿßŸÖŸé ÿßŸÑÿµŸéŸëÿßÿ¶ŸêŸÖŸêŸäŸÜŸé ŸàŸéŸÇŸêŸäŸéÿßŸÖŸêŸä ŸÅŸêŸäŸáŸê ŸÇŸêŸäŸéÿßŸÖŸé ÿßŸÑŸíŸÇŸéÿßÿ¶ŸêŸÖŸêŸäŸÜŸé", en: "O Allah, make my fasts the fasts of those who fast (sincerely), and my standing in prayer the standing of those who pray (obediently)." }, // Day 8
                { ar: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ŸÜŸéÿ®ŸêŸëŸáŸíŸÜŸêŸä ŸÅŸêŸäŸáŸê ŸÑŸêÿ®Ÿéÿ±ŸéŸÉŸéÿßÿ™Ÿê ÿ£Ÿéÿ≥Ÿíÿ≠Ÿéÿßÿ±ŸêŸáŸê ŸàŸéŸÜŸéŸàŸêŸëÿ±Ÿí ŸÅŸêŸäŸáŸê ŸÇŸéŸÑŸíÿ®ŸêŸä ÿ®Ÿêÿ∂ŸêŸäŸéÿßÿ°Ÿê ÿ£ŸéŸÜŸíŸàŸéÿßÿ±ŸêŸáŸê", en: "O Allah, alert me to the blessings of its dawns, and illuminate my heart with the brightness of its lights." }, // Day 9
                { ar: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿßÿ∫Ÿíÿ≥ŸêŸÑŸíŸÜŸêŸä ŸÅŸêŸäŸáŸê ŸÖŸêŸÜŸé ÿßŸÑÿ∞ŸèŸëŸÜŸèŸàÿ®Ÿê ŸàŸéÿ∑ŸéŸáŸêŸëÿ±ŸíŸÜŸêŸä ŸÅŸêŸäŸáŸê ŸÖŸêŸÜŸé ÿßŸÑŸíÿπŸèŸäŸèŸàÿ®Ÿê", en: "O Allah, wash away my sins, and purify me from flaws." }, // Day 10
                { ar: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ•ŸêŸÜŸêŸëŸä ÿ£Ÿéÿ≥Ÿíÿ£ŸéŸÑŸèŸÉŸé ÿßŸÑŸíŸáŸèÿØŸéŸâ ŸàŸéÿßŸÑÿ™ŸèŸëŸÇŸéŸâ ŸàŸéÿßŸÑŸíÿπŸéŸÅŸéÿßŸÅŸé ŸàŸéÿßŸÑŸíÿ∫ŸêŸÜŸéŸâ", en: "O Allah, I ask You for guidance, piety, chastity, and self-sufficiency." }, // Day 11
                { ar: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ŸàŸéŸÅŸêŸëŸÇŸíŸÜŸêŸä ŸÅŸêŸäŸáŸê ŸÑŸêŸÖŸèŸàŸéÿßŸÅŸéŸÇŸéÿ©Ÿê ÿßŸÑŸíÿ£Ÿéÿ®Ÿíÿ±Ÿéÿßÿ±Ÿê ŸàŸéÿ¨ŸéŸÜŸêŸëÿ®ŸíŸÜŸêŸä ŸÅŸêŸäŸáŸê ŸÖŸèÿ±ŸéÿßŸÅŸéŸÇŸéÿ©Ÿé ÿßŸÑŸíÿ£Ÿéÿ¥Ÿíÿ±Ÿéÿßÿ±Ÿê", en: "O Allah, guide me to accompany the righteous, and keep me away from the company of the wicked." }, // Day 12
                { ar: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿßÿ¨ŸíÿπŸéŸÑŸí ÿµŸêŸäŸéÿßŸÖŸêŸä ŸÅŸêŸäŸáŸê ÿ®ŸêÿßŸÑÿ¥ŸèŸëŸÉŸíÿ±Ÿê ŸàŸéÿßŸÑŸíŸÇŸéÿ®ŸèŸàŸÑŸê ÿπŸéŸÑŸéŸâ ŸÖŸéÿß ÿ™Ÿéÿ±Ÿíÿ∂ŸéÿßŸáŸè ŸàŸéŸäŸéÿ±Ÿíÿ∂ŸéÿßŸáŸè ÿßŸÑÿ±ŸéŸëÿ≥ŸèŸàŸÑŸè", en: "O Allah, make my fast accepted and appreciated according to what pleases You and the Messenger." }, // Day 13
                { ar: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ŸÇŸéÿ±ŸêŸëÿ®ŸíŸÜŸêŸä ŸÅŸêŸäŸáŸê ÿ•ŸêŸÑŸéŸâ ŸÖŸéÿ±Ÿíÿ∂Ÿéÿßÿ™ŸêŸÉŸé ŸàŸéÿ¨ŸéŸÜŸêŸëÿ®ŸíŸÜŸêŸä ŸÅŸêŸäŸáŸê ŸÖŸêŸÜŸí ÿ≥ŸéÿÆŸéÿ∑ŸêŸÉŸé ŸàŸéŸÜŸéŸÇŸêŸÖŸéÿßÿ™ŸêŸÉŸé", en: "O Allah, draw me closer to Your pleasure and keep me away from Your anger and punishment." }, // Day 14
                { ar: "ÿ±Ÿéÿ®ŸéŸëŸÜŸéÿß ŸÑÿßŸé ÿ™Ÿèÿ≤Ÿêÿ∫Ÿí ŸÇŸèŸÑŸèŸàÿ®ŸéŸÜŸéÿß ÿ®ŸéÿπŸíÿØŸé ÿ•Ÿêÿ∞Ÿí ŸáŸéÿØŸéŸäŸíÿ™ŸéŸÜŸéÿß ŸàŸéŸáŸéÿ®Ÿí ŸÑŸéŸÜŸéÿß ŸÖŸêŸÜ ŸÑŸéŸëÿØŸèŸÜŸÉŸé ÿ±Ÿéÿ≠ŸíŸÖŸéÿ©Ÿã", en: "O Allah, let not our hearts deviate after You have guided us and grant us from Yourself mercy." }, // Day 15
                { ar: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿßÿ¨ŸíÿπŸéŸÑŸíŸÜŸêŸä ŸÅŸêŸäŸáŸê ŸÖŸèÿ≠Ÿêÿ®ŸëÿßŸã ŸÑŸêÿ£ŸéŸàŸíŸÑŸêŸäŸéÿßÿ¶ŸêŸÉŸé ŸàŸéŸÖŸèÿπŸéÿßÿØŸêŸäÿßŸã ŸÑŸêÿ£ŸéÿπŸíÿØŸéÿßÿ¶ŸêŸÉŸé", en: "O Allah, make me a lover of Your friends and an enemy of Your enemies." }, // Day 16
                { ar: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ∫Ÿéÿ¥ŸêŸëŸÜŸêŸä ŸÅŸêŸäŸáŸê ÿ®ŸêÿßŸÑÿ±ŸéŸëÿ≠ŸíŸÖŸéÿ©Ÿê ŸàŸéÿßÿ±Ÿíÿ≤ŸèŸÇŸíŸÜŸêŸä ŸÅŸêŸäŸáŸê ÿßŸÑÿ™ŸéŸëŸàŸíŸÅŸêŸäŸÇŸé ŸàŸéÿßŸÑŸíÿπŸêÿµŸíŸÖŸéÿ©Ÿé", en: "O Allah, cover me with mercy, and grant me success and protection." }, // Day 17
                { ar: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿßŸáŸíÿØŸêŸÜŸêŸä ŸÅŸêŸäŸáŸê ŸÑŸêÿµŸéÿßŸÑŸêÿ≠Ÿê ÿßŸÑŸíÿ£ŸéÿπŸíŸÖŸéÿßŸÑŸê ŸàŸéÿßŸÇŸíÿ∂Ÿê ŸÑŸêŸä ŸÅŸêŸäŸáŸê ÿßŸÑŸíÿ≠ŸéŸàŸéÿßÿ¶Ÿêÿ¨Ÿé ŸàŸéÿßŸÑŸíÿ¢ŸÖŸéÿßŸÑŸé", en: "O Allah, guide me to righteous deeds, and fulfill my needs and hopes." }, // Day 18
                { ar: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿßÿ±Ÿíÿ≤ŸèŸÇŸíŸÜŸêŸä ŸÅŸêŸäŸáŸê ÿ∑ŸéÿßÿπŸéÿ©Ÿé ÿßŸÑŸíÿÆŸéÿßÿ¥ŸêÿπŸêŸäŸÜŸé ŸàŸéÿßÿ¥Ÿíÿ±Ÿéÿ≠Ÿí ŸÅŸêŸäŸáŸê ÿµŸéÿØŸíÿ±ŸêŸä ÿ®Ÿêÿ•ŸêŸÜŸéÿßÿ®Ÿéÿ©Ÿê ÿßŸÑŸíŸÖŸèÿÆŸíÿ®Ÿêÿ™ŸêŸäŸÜŸé", en: "O Allah, grant me the obedience of the humble, and expand my chest with the repentance of the submissive." }, // Day 19
                { ar: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ•ŸêŸÜŸéŸëŸÉŸé ÿπŸéŸÅŸèŸàŸåŸë ÿ™Ÿèÿ≠Ÿêÿ®ŸèŸë ÿßŸÑŸíÿπŸéŸÅŸíŸàŸé ŸÅŸéÿßÿπŸíŸÅŸè ÿπŸéŸÜŸêŸëŸä", en: "O Allah, You are forgiving and love forgiveness, so forgive me." }, // Day 20
                { ar: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ŸàŸéŸÅŸêŸëŸÇŸí ÿ≠Ÿéÿ∏ŸêŸëŸä ŸÅŸêŸäŸáŸê ŸÖŸêŸÜŸé ÿßŸÑŸÜŸéŸëŸàŸéÿßŸÅŸêŸÑŸê ŸàŸéÿ£ŸéŸÉŸíÿ±ŸêŸÖŸíŸÜŸêŸä ŸÅŸêŸäŸáŸê ÿ®Ÿêÿ•Ÿêÿ≠Ÿíÿ∂Ÿéÿßÿ±Ÿê ÿßŸÑŸíŸÖŸéÿ≥Ÿéÿßÿ¶ŸêŸÑŸê", en: "O Allah, increase my share of voluntary acts, and honor me by fulfilling my requests." }, // Day 21
                { ar: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿßÿ±Ÿíÿ≤ŸèŸÇŸíŸÜŸêŸä ŸÅŸêŸäŸáŸê ÿßŸÑÿ∞ŸêŸëŸáŸíŸÜŸé ŸàŸéÿßŸÑÿ™ŸéŸëŸÜŸíÿ®ŸêŸäŸáŸé ŸàŸéÿ®ŸéÿßÿπŸêÿØŸíŸÜŸêŸä ŸÅŸêŸäŸáŸê ŸÖŸêŸÜŸé ÿßŸÑÿ≥ŸéŸëŸÅŸéÿßŸáŸéÿ©Ÿê ŸàŸéÿßŸÑÿ™ŸéŸëŸÖŸíŸàŸêŸäŸáŸê", en: "O Allah, grant me intellect and awareness, and keep me away from foolishness and deception." }, // Day 22
                { ar: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ∑ŸéŸáŸêŸëÿ±ŸíŸÜŸêŸä ŸÅŸêŸäŸáŸê ŸÖŸêŸÜŸé ÿßŸÑÿØŸéŸëŸÜŸéÿ≥Ÿê ŸàŸéÿßŸÑŸíÿ£ŸéŸÇŸíÿ∞Ÿéÿßÿ±Ÿê ŸàŸéÿµŸéÿ®ŸêŸëÿ±ŸíŸÜŸêŸä ŸÅŸêŸäŸáŸê ÿπŸéŸÑŸéŸâ ŸÉŸéÿßÿ¶ŸêŸÜŸéÿßÿ™Ÿê ÿßŸÑŸíÿ£ŸéŸÇŸíÿØŸéÿßÿ±Ÿê", en: "O Allah, purify me from uncleanliness and dirt, and make me patient over the events of decree." }, // Day 23
                { ar: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ•ŸêŸÜŸêŸëŸä ÿ£Ÿéÿ≥Ÿíÿ£ŸéŸÑŸèŸÉŸé ŸÅŸêŸäŸáŸê ŸÖŸéÿß ŸäŸèÿ±Ÿíÿ∂ŸêŸäŸÉŸé ŸàŸéÿ£ŸéÿπŸèŸàÿ∞Ÿè ÿ®ŸêŸÉŸé ŸÖŸêŸÖŸéŸëÿß ŸäŸèÿ§Ÿíÿ∞ŸêŸäŸÉŸé", en: "O Allah, I ask You for what pleases You, and I seek refuge in You from what displeases You." }, // Day 24
                { ar: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ≠Ÿéÿ®ŸêŸëÿ®Ÿí ÿ•ŸêŸÑŸéŸäŸéŸë ŸÅŸêŸäŸáŸê ÿßŸÑŸíÿ•Ÿêÿ≠Ÿíÿ≥ŸéÿßŸÜŸé ŸàŸéŸÉŸéÿ±ŸêŸëŸáŸí ÿ•ŸêŸÑŸéŸäŸéŸë ŸÅŸêŸäŸáŸê ÿßŸÑŸíŸÅŸèÿ≥ŸèŸàŸÇŸé ŸàŸéÿßŸÑŸíÿπŸêÿµŸíŸäŸéÿßŸÜŸé", en: "O Allah, make goodness beloved to me and make immorality and disobedience hateful to me." }, // Day 25
                { ar: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿßÿ¨ŸíÿπŸéŸÑŸí ÿ≥ŸéÿπŸíŸäŸêŸä ŸÅŸêŸäŸáŸê ŸÖŸéÿ¥ŸíŸÉŸèŸàÿ±ÿßŸã ŸàŸéÿ∞ŸéŸÜŸíÿ®ŸêŸä ŸÅŸêŸäŸáŸê ŸÖŸéÿ∫ŸíŸÅŸèŸàÿ±ÿßŸã", en: "O Allah, make my effort appreciated and my sin forgiven." }, // Day 26
                { ar: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ŸàŸéŸÅŸêŸëÿ±Ÿí ŸÅŸêŸäŸáŸê ÿ≠Ÿéÿ∏ŸêŸëŸä ŸÖŸêŸÜŸí ÿ®Ÿéÿ±ŸéŸÉŸéÿßÿ™ŸêŸáŸê ŸàŸéÿ≥ŸéŸáŸêŸëŸÑŸí ÿ≥Ÿéÿ®ŸêŸäŸÑŸêŸä ÿ•ŸêŸÑŸéŸâ ÿÆŸéŸäŸíÿ±Ÿéÿßÿ™ŸêŸáŸê", en: "O Allah, increase my share of its blessings, and make easy my path to its goodness." }, // Day 27
                { ar: "ÿßŸÑŸÑŸëŸéŸáŸèŸÖŸëŸé ÿ£ŸéÿπŸêŸÜŸëŸêŸä ÿπŸéŸÑŸéŸâ ÿ∞ŸêŸÉŸíÿ±ŸêŸÉŸé ŸàŸéÿ¥ŸèŸÉŸíÿ±ŸêŸÉŸé ŸàŸéÿ≠Ÿèÿ≥ŸíŸÜŸê ÿπŸêÿ®ŸéÿßÿØŸéÿ™ŸêŸÉŸé", en: "O Allah, help me to remember You, to thank You, and to worship You in the best of manners." }, // Day 28
                { ar: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿßŸÅŸíÿ™Ÿéÿ≠Ÿí ŸÑŸêŸä ŸÅŸêŸäŸáŸê ÿ£Ÿéÿ®ŸíŸàŸéÿßÿ®Ÿé ÿßŸÑŸíÿ¨ŸêŸÜŸéÿßŸÜŸê ŸàŸéÿ£Ÿéÿ∫ŸíŸÑŸêŸÇŸí ÿπŸéŸÜŸêŸëŸä ŸÅŸêŸäŸáŸê ÿ£Ÿéÿ®ŸíŸàŸéÿßÿ®Ÿé ÿßŸÑŸÜŸêŸëŸäÿ±ŸéÿßŸÜŸê", en: "O Allah, open for me the gates of Paradise, and close for me the gates of Hellfire." }, // Day 29
                { ar: "ÿ±Ÿéÿ®ŸéŸëŸÜŸéÿß ÿ™ŸéŸÇŸéÿ®ŸéŸëŸÑŸí ŸÖŸêŸÜŸéŸëÿß ÿ•ŸêŸÜŸéŸëŸÉŸé ÿ£ŸéŸÜŸíÿ™Ÿé ÿßŸÑÿ≥ŸéŸëŸÖŸêŸäÿπŸè ÿßŸÑŸíÿπŸéŸÑŸêŸäŸÖŸè", en: "O Allah, accept from us; indeed You are the Hearing, the Knowing." } // Day 30
            ];

            const el = (id) => document.getElementById(id);
            const ramadanDayEl = el('ramadanDay');
            const duaMainEl = el('duaMain');
            const duaTranslationEl = el('duaTranslation');
            const currentDateEl = el('currentDate');
            const footerEl = el('footerText');
            const dropdownEl = el('colorDropdown');
            const langBtn = el('langToggle');
            const particlesContainer = el('particlesContainer');
            const paletteIcon = el('paletteIcon');
            const colorToggleBtn = el('colorToggle');
            const controlsContainer = el('controlsContainer');
            const footerContainer = el('footerContainer');
            const dayBadgeContainer = el('dayBadgeContainer');
            const separatorLine = el('separatorLine');
            const quoteTop = el('quoteTop');
            const quoteBottom = el('quoteBottom');
            const metaThemeColor = el('metaThemeColor');
            
            const customModal = el('customColorModal');
            const modalContent = el('colorModalContent');
            const colorWheel = el('colorWheel');
            const colorThumb = el('colorThumb');
            const colorCenterPreview = el('colorCenterPreview');

            async function transitionToDay(newDay) {
                const textElements = [ramadanDayEl, duaMainEl, duaTranslationEl, currentDateEl, footerEl];
                textElements.forEach(e => { if(e) e.classList.add('blur-fade-out'); });
                
                await new Promise(r => setTimeout(r, 400));
                
                currentActiveDay = newDay;
                updateUI();
                
                await new Promise(r => requestAnimationFrame(r));
                textElements.forEach(e => { if(e) e.classList.remove('blur-fade-out'); });
            }

            // --- TIME MACHINE ROLLER LOGIC ---
            const badgeWrapper = el('badgeWrapper');
            const rollerContainer = el('dayRoller');
            const rollerInner = el('rollerInner');
            let isRollerActive = false;
            let tapCount = 0;
            let tapTimer;
            
            function closeRoller(confirmAction) {
                if (!isRollerActive) return;
                
                let selectedDay = currentActiveDay;
                if (confirmAction) {
                    let itemHeight = 40; 
                    let index = Math.round(rollerContainer.scrollTop / itemHeight);
                    selectedDay = index + 1; 
                }
                
                isRollerActive = false;
                badgeWrapper.classList.remove('badge-open');
                
                setTimeout(() => {
                    rollerContainer.classList.add('hidden');
                    ramadanDayEl.classList.remove('opacity-0');
                    
                    if (confirmAction && selectedDay !== currentActiveDay) {
                        transitionToDay(selectedDay);
                    } else {
                        rollerContainer.scrollTop = (currentActiveDay - 1) * 40;
                    }
                }, 300); 
            }

            badgeWrapper.addEventListener('click', (e) => {
                if (isRollerActive) {
                    closeRoller(true); // User tapped the menu directly, so we CONFIRM the change
                    return;
                }

                tapCount++;
                clearTimeout(tapTimer);
                if (tapCount === 3) {
                    tapCount = 0;
                    isRollerActive = true;
                    
                    populateRoller();
                    
                    ramadanDayEl.classList.add('opacity-0');
                    badgeWrapper.classList.add('badge-open');
                    
                    setTimeout(() => {
                        rollerContainer.classList.remove('hidden');
                        rollerContainer.scrollTop = (currentActiveDay - 1) * 40;
                    }, 150); 
                } else {
                    tapTimer = setTimeout(() => { tapCount = 0; }, 500);
                }
            });

            function populateRoller() {
                rollerInner.innerHTML = '';
                
                let padTop = document.createElement('div');
                padTop.className = 'roller-item'; 
                rollerInner.appendChild(padTop);

                for(let i=1; i<=30; i++) {
                    let div = document.createElement('div');
                    div.className = 'roller-item text-xs sm:text-sm md:text-base font-bold tracking-[0.2em] uppercase select-none transition-colors duration-200';
                    
                    if (lang === 'en') {
                        div.innerText = `DAY ${i}`;
                    } else {
                        div.innerText = `ÿßŸÑŸäŸàŸÖ ${toArabicNumerals(i)}`;
                    }
                    rollerInner.appendChild(div);
                }
                
                let padBot = document.createElement('div');
                padBot.className = 'roller-item'; 
                rollerInner.appendChild(padBot);
                highlightRollerCenter();
            }
            
            rollerContainer.addEventListener('scroll', () => {
                if(!isRollerActive) return;
                window.requestAnimationFrame(highlightRollerCenter);
            });

            function highlightRollerCenter() {
                let index = Math.round(rollerContainer.scrollTop / 40);
                let items = rollerInner.children;
                for(let i=1; i<=30; i++) {
                    if (i === index + 1) {
                        items[i].classList.add('text-theme-light', 'dark:text-theme-dark', 'scale-110');
                        items[i].classList.remove('text-gray-400', 'dark:text-gray-600');
                    } else {
                        items[i].classList.remove('text-theme-light', 'dark:text-theme-dark', 'scale-110');
                        items[i].classList.add('text-gray-400', 'dark:text-gray-600');
                    }
                }
            }

            // --- BASIC SETUP & ANIMATIONS ---
            function createParticles() {
                if (!particlesContainer) return;
                particlesContainer.innerHTML = ''; 
                for(let i=0; i<30; i++) { 
                    const p = document.createElement('div');
                    p.classList.add('particle', 'text-theme-light', 'dark:text-theme-dark');
                    const size = Math.random() * 5 + 2 + 'px'; 
                    p.style.width = size;
                    p.style.height = size;
                    p.style.left = Math.random() * 100 + '%';
                    const duration = Math.random() * 20 + 10; 
                    const delay = Math.random() * -30; 
                    p.style.animationDuration = duration + 's';
                    p.style.animationDelay = delay + 's';
                    p.style.setProperty('--p-opacity', Math.random() * 0.5 + 0.2);
                    particlesContainer.appendChild(p);
                }
            }

            function toArabicNumerals(numStr) {
                return String(numStr).replace(/[0-9]/g, function(d) {
                    return String.fromCharCode(d.charCodeAt(0) + 1584);
                });
            }

            function getFormattedDate(locale) {
                const now = new Date();
                const rDay = currentActiveDay; 
                const rYear = 1447; 
                
                if(locale === 'ar') {
                    const options = { day: 'numeric', month: 'long', year: 'numeric' };
                    const gregorian = new Intl.DateTimeFormat('ar-EG', options).format(now);
                    
                    const arDay = toArabicNumerals(rDay);
                    const arYear = toArabicNumerals(rYear);
                    
                    return `${arDay} ÿ±ŸÖÿ∂ÿßŸÜ ${arYear} ‚Ä¢ ${gregorian}`;
                } else {
                    const options = { month: 'long', day: 'numeric', year: 'numeric' };
                    const gregorian = new Intl.DateTimeFormat('en-US', options).format(now);
                    return `Ramadan ${rDay}, ${rYear} ‚Ä¢ ${gregorian}`;
                }
            }

            // --- CUSTOM COLOR WHEEL LOGIC ---
            function hslToRgb(h, s, l) {
                h /= 360;
                let r, g, b;
                if (s === 0) { r = g = b = l; } else {
                    const hue2rgb = (p, q, t) => {
                        if (t < 0) t += 1;
                        if (t > 1) t -= 1;
                        if (t < 1 / 6) return p + (q - p) * 6 * t;
                        if (t < 1 / 2) return q;
                        if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;
                        return p;
                    };
                    const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
                    const p = 2 * l - q;
                    r = hue2rgb(p, q, h + 1 / 3);
                    g = hue2rgb(p, q, h);
                    b = hue2rgb(p, q, h - 1 / 3);
                }
                return [Math.round(r * 255), Math.round(g * 255), Math.round(b * 255)];
            }

            function updatePreviewColors(hue) {
                const darkRgbArr = hslToRgb(hue, 1, 0.6);
                const hexColor = '#' + darkRgbArr.map(x => x.toString(16).padStart(2, '0')).join('');
                
                colorThumb.style.backgroundColor = hexColor;
                colorCenterPreview.style.backgroundColor = hexColor;
            }

            function applySiteThemeColors(hue) {
                const darkRgbArr = hslToRgb(hue, 1, 0.6);
                const lightRgbArr = hslToRgb(hue, 1, 0.4);

                const rgbToHex = (arr) => '#' + arr.map(x => x.toString(16).padStart(2, '0')).join('');
                
                document.documentElement.style.setProperty('--theme-light', rgbToHex(lightRgbArr));
                document.documentElement.style.setProperty('--theme-dark', rgbToHex(darkRgbArr));
                document.documentElement.style.setProperty('--theme-light-rgb', lightRgbArr.join(', '));
                document.documentElement.style.setProperty('--theme-dark-rgb', darkRgbArr.join(', '));
            }

            function setThumbPositionFromHue(hue) {
                let angle = hue - 90; 
                let angleRad = angle * (Math.PI / 180);

                const rect = colorWheel.getBoundingClientRect();
                const radius = rect.width / 2;
                const trackRadius = radius - 12; 
                
                const centerX = radius;
                const centerY = radius;

                const x = centerX + Math.cos(angleRad) * trackRadius;
                const y = centerY + Math.sin(angleRad) * trackRadius;

                colorThumb.style.left = `${x}px`;
                colorThumb.style.top = `${y}px`;
            }

            let isDraggingWheel = false;

            function handleWheelDrag(e) {
                if (!isDraggingWheel) return;
                
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const clientY = e.touches ? e.touches[0].clientY : e.clientY;

                const rect = colorWheel.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;

                const dx = clientX - centerX;
                const dy = clientY - centerY;

                let angleRad = Math.atan2(dy, dx);
                let angleDeg = angleRad * (180 / Math.PI);
                
                let hue = (angleDeg + 90 + 360) % 360;
                
                tempHue = hue;
                updatePreviewColors(tempHue);
                setThumbPositionFromHue(tempHue);
            }

            const stopDragging = () => {
                if (isDraggingWheel) {
                    isDraggingWheel = false;
                    applySiteThemeColors(tempHue); 
                }
            };

            colorWheel.addEventListener('mousedown', (e) => { isDraggingWheel = true; handleWheelDrag(e); });
            colorWheel.addEventListener('touchstart', (e) => { isDraggingWheel = true; handleWheelDrag(e); }, {passive: false});
            window.addEventListener('mousemove', handleWheelDrag);
            window.addEventListener('touchmove', (e) => { if(isDraggingWheel) e.preventDefault(); handleWheelDrag(e); }, {passive: false});
            window.addEventListener('mouseup', stopDragging);
            window.addEventListener('touchend', stopDragging);

            window.openColorPicker = (e) => {
                if(e) e.stopPropagation();
                closeDropdown();
                
                let startHue = currentColorIndex === -1 ? customHue : 152; 
                customModal.classList.remove('opacity-0', 'pointer-events-none');
                modalContent.classList.remove('scale-95');
                modalContent.classList.add('scale-100');
                
                setTimeout(() => { 
                    updatePreviewColors(startHue);
                    setThumbPositionFromHue(startHue); 
                }, 50);
            };

            window.closeColorPicker = (e, apply = false) => {
                if(e) e.stopPropagation();
                
                if(apply) {
                    customHue = tempHue;
                    safeStorage.setItem('saved_custom_hue', customHue);
                    currentColorIndex = -1; 
                    safeStorage.setItem('saved_color_index', currentColorIndex);
                    applySiteThemeColors(customHue);
                } else {
                    applyColorTheme(currentColorIndex); 
                }

                customModal.classList.add('opacity-0', 'pointer-events-none');
                modalContent.classList.remove('scale-100');
                modalContent.classList.add('scale-95');
            };

            function applyColorTheme(index) {
                if (index === -1) {
                    applySiteThemeColors(customHue);
                } else {
                    if (!colorThemes[index]) index = 0;
                    const theme = colorThemes[index];
                    document.documentElement.style.setProperty('--theme-light', theme.light);
                    document.documentElement.style.setProperty('--theme-dark', theme.dark);
                    document.documentElement.style.setProperty('--theme-light-rgb', theme.rgbLight);
                    document.documentElement.style.setProperty('--theme-dark-rgb', theme.rgbDark);
                }
            }

            window.toggleColorDropdown = (e) => {
                e.stopPropagation();
                if (dropdownOpen) closeDropdown();
                else openDropdown();
            };

            window.selectColor = (index) => {
                if (index === currentColorIndex) { closeDropdown(); return; }
                currentColorIndex = index;
                safeStorage.setItem('saved_color_index', currentColorIndex);
                applyColorTheme(currentColorIndex);
                closeDropdown();
            };

            window.toggleLanguage = async () => {
                const textElements = [ramadanDayEl, duaMainEl, duaTranslationEl, currentDateEl, footerEl];
                
                textElements.forEach(el => { if(el) el.classList.add('blur-fade-out'); });

                await new Promise(r => setTimeout(r, 400));
                
                lang = lang === 'en' ? 'ar' : 'en';
                safeStorage.setItem('saved_lang', lang); 
                updateUI();
                
                await new Promise(r => requestAnimationFrame(r));
                await new Promise(r => requestAnimationFrame(r));
                
                textElements.forEach(el => { if(el) el.classList.remove('blur-fade-out'); });
            };

            window.toggleTheme = () => {
                const isDark = document.documentElement.classList.toggle('dark');
                safeStorage.setItem('saved_theme', isDark ? 'dark' : 'light');
                updateThemeIcon(isDark);
            };
            
            function toggleZenMode() {
                isZenMode = !isZenMode;
                if (isZenMode) {
                    controlsContainer.classList.add('opacity-0', 'pointer-events-none');
                } else {
                    controlsContainer.classList.remove('opacity-0', 'pointer-events-none');
                }
            }

            function openDropdown() {
                dropdownEl.classList.remove('dropdown-enter');
                dropdownEl.classList.add('dropdown-active');
                paletteIcon.classList.add('rotate-icon');
                colorToggleBtn.classList.add('text-theme-light', 'dark:text-theme-dark');
                dropdownOpen = true;
            }

            function closeDropdown() {
                dropdownEl.classList.remove('dropdown-active');
                dropdownEl.classList.add('dropdown-enter');
                paletteIcon.classList.remove('rotate-icon');
                colorToggleBtn.classList.remove('text-theme-light', 'dark:text-theme-dark');
                dropdownOpen = false;
            }

            document.addEventListener('click', (e) => {
                if (dropdownOpen && !e.target.closest('#colorToggle') && !e.target.closest('#colorDropdown')) {
                    closeDropdown();
                    return; 
                }

                if (isRollerActive && !e.target.closest('#badgeWrapper')) {
                    closeRoller(false); // Pass false to CANCEL the change and revert
                    return;
                }
                
                if (!e.target.closest('button') && 
                    !e.target.closest('#colorDropdown') && 
                    !e.target.closest('#customColorModal') && 
                    !e.target.closest('#badgeWrapper') &&
                    !e.target.closest('#footerText')) {
                    toggleZenMode();
                }
            });

            function setClassSafely(elem, newClass) {
                if (!elem) return;
                const hasBlur = elem.classList.contains('blur-fade-out');
                elem.className = newClass;
                if (hasBlur) elem.classList.add('blur-fade-out');
            }

            function updateUI() {
                const day = currentActiveDay; 
                
                document.documentElement.lang = lang;
                document.documentElement.setAttribute('dir', lang === 'ar' ? 'rtl' : 'ltr');
                if(currentDateEl) currentDateEl.setAttribute('dir', lang === 'ar' ? 'rtl' : 'ltr');

                if (day > 30) {
                    dayBadgeContainer.classList.add('hidden');
                    separatorLine.classList.add('hidden');
                    quoteTop.classList.add('hidden');
                    quoteBottom.classList.add('hidden');
                    
                    duaMainEl.innerText = lang === 'en' ? "Eid Mubarak" : "ÿπŸäÿØ ŸÖÿ®ÿßÿ±ŸÉ";
                    setClassSafely(duaMainEl, "animate-breathe text-4xl sm:text-5xl md:text-7xl font-bold tracking-normal mb-2 leading-loose text-[#D4AF37] dark:text-[#FFD700] font-amiri drop-shadow-md flex items-center justify-center py-2 max-w-full min-h-[100px] md:min-h-[140px]");
                    
                    duaTranslationEl.innerText = lang === 'en' ? "May Allah accept from us and from you." : "ÿ™ŸÇÿ®ŸÑ ÿßŸÑŸÑŸá ŸÖŸÜÿß ŸàŸÖŸÜŸÉŸÖ ÿµÿßŸÑÿ≠ ÿßŸÑÿ£ÿπŸÖÿßŸÑ";
                    duaTranslationEl.classList.remove('hidden');
                    currentDateEl.innerText = ""; 
                    
                    if (lang === 'en') {
                        langBtn.innerText = "AR";
                        footerEl.innerText = "Created by Marwan Elmoghazy.";
                        setClassSafely(footerEl, "pointer-events-auto text-[8px] sm:text-[10px] md:text-xs text-gray-400 dark:text-gray-600 font-bold uppercase tracking-[0.2em] hover:text-theme-light dark:hover:text-theme-dark cursor-pointer opacity-60 hover:opacity-100 transition-colors");
                    } else {
                        langBtn.innerText = "EN";
                        footerEl.innerText = "ÿ™ŸÖ ÿßŸÑÿ•ŸÜÿ¥ÿßÿ° ŸàÿßŸÑÿ™ÿ∑ŸàŸäÿ± ÿ®Ÿàÿßÿ≥ÿ∑ÿ© ŸÖÿ±ŸàÿßŸÜ ÿßŸÑŸÖÿ∫ÿßÿ≤Ÿä.";
                        setClassSafely(footerEl, "pointer-events-auto text-[10px] sm:text-xs md:text-sm text-gray-400 dark:text-gray-600 font-bold uppercase tracking-[0.2em] hover:text-theme-light dark:hover:text-theme-dark cursor-pointer opacity-60 hover:opacity-100 transition-colors");
                    }
                    return; 
                }

                const duaIndex = Math.max(0, (day - 1) % duas.length); 
                const currentDua = duas[duaIndex];

                duaMainEl.innerText = currentDua.ar;
                setClassSafely(duaMainEl, "animate-breathe text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold tracking-normal mb-2 leading-loose text-gray-900 dark:text-white font-amiri drop-shadow-sm flex items-center justify-center py-2 max-w-full min-h-[100px] md:min-h-[140px] dark:text-neon");
                
                duaTranslationEl.innerText = currentDua.en;
                duaTranslationEl.classList.remove('hidden');

                if (lang === 'en') {
                    ramadanDayEl.innerText = `Day ${day} of Ramadan`;
                    ramadanDayEl.style.fontFamily = '"Outfit", sans-serif';
                    
                    currentDateEl.innerText = getFormattedDate('en'); 
                    langBtn.innerText = "AR";
                    footerEl.innerText = "Created by Marwan Elmoghazy.";
                    setClassSafely(footerEl, "pointer-events-auto text-[8px] sm:text-[10px] md:text-xs text-gray-400 dark:text-gray-600 font-bold uppercase tracking-[0.2em] hover:text-theme-light dark:hover:text-theme-dark cursor-pointer opacity-60 hover:opacity-100 transition-colors");

                } else {
                    ramadanDayEl.innerText = `ÿßŸÑŸäŸàŸÖ ${toArabicNumerals(day)} ŸÖŸÜ ÿ±ŸÖÿ∂ÿßŸÜ`;
                    ramadanDayEl.style.fontFamily = '"Cairo", sans-serif';
                    
                    currentDateEl.innerText = getFormattedDate('ar'); 
                    langBtn.innerText = "EN";
                    footerEl.innerText = "ÿ™ŸÖ ÿßŸÑÿ•ŸÜÿ¥ÿßÿ° ŸàÿßŸÑÿ™ÿ∑ŸàŸäÿ± ÿ®Ÿàÿßÿ≥ÿ∑ÿ© ŸÖÿ±ŸàÿßŸÜ ÿßŸÑŸÖÿ∫ÿßÿ≤Ÿä.";
                    setClassSafely(footerEl, "pointer-events-auto text-[11px] sm:text-xs md:text-sm text-gray-400 dark:text-gray-600 font-bold uppercase tracking-[0.2em] hover:text-theme-light dark:hover:text-theme-dark cursor-pointer opacity-60 hover:opacity-100 transition-colors");
                }
            }

            function updateThemeIcon(isDark) {
                const sun = el('sunIcon');
                const moon = el('moonIcon');
                if(!sun || !moon) return;
                
                if(metaThemeColor) {
                    metaThemeColor.setAttribute('content', isDark ? '#000000' : '#F9FAFB');
                }

                if (isDark) {
                    sun.classList.remove('opacity-100', 'scale-100', 'rotate-0');
                    sun.classList.add('opacity-0', 'scale-50', 'rotate-90');
                    moon.classList.remove('opacity-0', 'scale-50', '-rotate-90');
                    moon.classList.add('opacity-100', 'scale-100', 'rotate-0');
                } else {
                    moon.classList.remove('opacity-100', 'scale-100', 'rotate-0');
                    moon.classList.add('opacity-0', 'scale-50', '-rotate-90');
                    sun.classList.remove('opacity-0', 'scale-50', 'rotate-90');
                    sun.classList.add('opacity-100', 'scale-100', 'rotate-0');
                }
            }

            if (isDark) document.documentElement.classList.add('dark');
            else document.documentElement.classList.remove('dark');
            
            applyColorTheme(currentColorIndex);
            updateThemeIcon(isDark);
            createParticles();
            updateUI();
        });
    </script>
</body>
</html>


